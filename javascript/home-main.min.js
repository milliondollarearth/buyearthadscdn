$(function(){var sectionsNavHeight=$("#sectionsNav").outerHeight();var footerNavHeight=$("#footer").outerHeight();var mapViewDivHeight=$("html,body").height()-sectionsNavHeight-footerNavHeight;$("#mapViewDiv").css({"position":"relative",'margin-top':sectionsNavHeight,"height":mapViewDivHeight});var latitude=$("#latitude").attr("data-id");var longitude=$("#longitude").attr("data-id");var isMobile=$("#isMobile").attr("data-value");var maxAltitudeScale,minAltitudeScale=0;var mapView_scale=0;if(isMobile==1){maxAltitudeScale=18489297.737236;minAltitudeScale=577790.554289;mapView_scale=13622324;var font_info={"family":"Roboto,Helvetica,Arial,sans-serif","size":'12px',"style":"normal","weight":"bolder","decoration":"none"}}else{maxAltitudeScale=36978595.474472;minAltitudeScale=3411167.83945312;mapView_scale=10866973.302927058;var font_info={"family":"Roboto,Helvetica,Arial,sans-serif","size":'12px',"style":"normal","weight":"lighter","decoration":"none"}}require(["esri/layers/WebTileLayer","esri/Basemap","esri/Map","esri/layers/GeoJSONLayer","esri/views/SceneView","esri/layers/support/LOD","dojo/domReady!"],function(WebTileLayer,Basemap,Map,GeoJSONLayer,SceneView,LOD){var domain=window.location.protocol+'//'+window.location.host;var html_lang=document.documentElement.lang;if(html_lang=='zh-CN'||html_lang=='zh-cn'){html_lang='zh_cn'}else if(html_lang=='de'){html_lang='de'}else if(html_lang=='es'){html_lang='es'}else if(html_lang=='fr'){html_lang='fr'}else if(html_lang=='jp'){html_lang='jp'}else{html_lang='en'}const tilesize=256;const earthCircumference=40075016.685568;const inchesPerMeter=39.37;const initialResolution=earthCircumference/tilesize;const dpi=100;const maxLevel=6;const squared=2;const lods=[];const lods_7=[];for(let level=0;level<=maxLevel;level++){const resolution=initialResolution/Math.pow(squared,level);const scale=resolution*dpi*inchesPerMeter;lods.push(new LOD({level:level,scale:scale,resolution:resolution}))}lods_7.push(new LOD({level:7,scale:4622324.434309019,resolution:1222.9924525625}));const tileInfo={dpi:dpi,size:tilesize,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:3857},lods:lods};const tileInfo_7={dpi:dpi,size:tilesize,origin:{x:-20037508.342787,y:20037508.342787},spatialReference:{wkid:3857},lods:lods_7};var mapBaseLayer=new WebTileLayer({urlTemplate:"https://cdn.jsdelivr.net/gh/milliondollarearth/mapstiles@1.0.0/{level}/{col}/{row}.jpeg",maxScale:6933486.651463529,tileInfo:tileInfo,});var mapBaseLayer_7=new WebTileLayer({urlTemplate:domain+"/themes/earth/assets/maps/{level}/{col}/{row}.jpeg",minScale:6933486.651463529,tileInfo:tileInfo_7});var stamen=new Basemap({baseLayers:[mapBaseLayer,mapBaseLayer_7],title:"Terrain",id:"terrain"});var map=new Map({basemap:stamen,});var mapView=new SceneView({container:"mapViewDiv",map:map,scale:mapView_scale,constraints:{altitude:{max:maxAltitudeScale,min:minAltitudeScale},}});if(latitude){mapView.center=[longitude,latitude]}else{longitude=120;latitude=33;mapView.center=[longitude,latitude]}const renderer={type:"simple",symbol:{type:"simple-fill",color:[130,159,83,0],outline:{width:1,color:[255,255,255,0.40]}}};var GeoJSONLayer=new GeoJSONLayer({url:"https://cdn.jsdelivr.net/gh/milliondollarearth/buyearthadscdn@1.0.1/json/total.json",outFields:["*"],renderer:renderer,maxScale:1155581,labelingInfo:[{labelExpressionInfo:{value:"{name_"+html_lang+"}"},minScale:16978595,maxScale:0,symbol:{type:"text",color:"#f7f6ff",font:font_info}}]});map.add(GeoJSONLayer);mapView.when(function(){$("#loading-box").hide()}).then(function(){return GeoJSONLayer.when()}).then(function(layerView){mapView.on("click",eventHandler);function eventHandler(event){mapView.hitTest(event).then(getGraphics)}function getGraphics(response){if(response.results.length){var is_buy=0;const graphic=response.results.filter(function(result){return result.graphic.layer===GeoJSONLayer})[0].graphic;const attributes=graphic.attributes;const ne_id=attributes.ne_id;$.request('ajaxmapsinfo::onPurchas',{success:function(data){$('.modal').modal('hide');is_buy=data.is_exist;if(data.is_exist==0){$("#link_image_src").attr("src",'storage/app/media/popup/province.png');$("#country").html(data.country);$("#area").html(data.province);$("#price").html('$'+data.province_price);var buy_link_href=domain+'/buy-now/'+ne_id;$("#buy-link").attr('href',buy_link_href);graphic.symbol={type:"simple-line",color:"#00fc7f",outline:{color:[128,128,128,0.5],width:"0.5px"}};$('#myModal').modal()}else if(data.is_exist==1){$(".link_brand_a").css({"background-color":data.color});$("#link_unpaid_image").attr("src",data.thumb);$("#link_unpaid_image").attr("alt",data.name);var img=new Image();img.src=data.image;img.onload=function(){$("#unpaidModal .modal-body").height();if($("html").width()<576){var card_box_height=100}$("#link_unpaid_image").height(card_box_height)};$("#link_unpaid_name").html(data.name);$("#link_unpaid_phone").html(data.phone);$("#link_unpaid_email").html(data.email);graphic.symbol={type:"simple-line",color:"#0771fc",outline:{color:[7,113,252,0.5],width:"0.5px"}};var curTime=moment(data.updated_at.date).add(7,'days').format("YYYY-MM-DD HH:mm");$("#continer").html(curTime);$('#unpaidModal').modal()}else if(data.is_exist==2){$(".link_brand_a").css({"background-color":data.color});$("#link_brand_image").attr("src",data.thumb);$("#link_brand_image").attr("alt",data.name);$("#link_brand_image_shadow").attr("src",data.image);var img=new Image();img.src=data.image;img.onload=function(){$("#unpaidModal .modal-body").height();if($("html").width()<576){var card_box_height=100}$("#link_brand_image").height(card_box_height)};$("#link_brand_name").html(data.name);$("#link_brand_phone").html(data.phone);$("#link_brand_email").html(data.email);graphic.symbol={type:"simple-line",color:"#fc7b00",outline:{color:[252,123,128,0.5],width:"0.5px"}};$(".link_brand_a").attr("href",data.url);$("#webLinkA").attr("href",data.url);$('#brandModal').modal()}mapView.graphics.removeAll();mapView.graphics.add(graphic)},data:{ne_id:ne_id,lang:html_lang}})}}})})});